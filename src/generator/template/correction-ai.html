<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Correction AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Inter', sans-serif;
        }

        .pill-container {
            background-color: #00c853;
            border-radius: 9999px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            z-index: 50;
        }

        .circle-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #004d40;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            color: white;
        }

        .circle-btn.recording {
            background-color: #ef4444;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { transform: scale(1); }
        }

        .panel {
            max-width: 400px;
            width: 90%;
            background: white;
            border-radius: 24px;
            padding: 24px;
            margin-top: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .panel.active { display: block; animation: slideUp 0.3s ease-out; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .mushaf-box {
            background: #fffef0;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 15px;
            text-align: right;
            font-size: 1.5rem;
            direction: rtl;
            min-height: 80px;
            margin-bottom: 10px;
        }

        .correction-box {
            font-size: 0.9rem;
            padding: 10px;
            border-radius: 8px;
            background: #f9fafb;
            border: 1px dashed #d1d5db;
        }

        .word-correct { color: #059669; font-weight: bold; }
        .word-wrong { color: #dc2626; text-decoration: underline; font-weight: bold; }
    </style>
</head>
<body>

    <div class="flex flex-col items-center p-4 w-full">
        <!-- Tombol Utama -->
        <div class="pill-container">
            <button id="micBtn" class="circle-btn">
                <i data-lucide="mic" size="32"></i>
            </button>
            <button id="speakerBtn" class="circle-btn">
                <i data-lucide="volume-2" size="32"></i>
            </button>
        </div>

        <!-- Panel Koreksi (Muncul saat Mic ditekan) -->
        <div id="correctionPanel" class="panel">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center text-red-600 font-bold text-sm">
                    <span class="w-2 h-2 bg-red-600 rounded-full mr-2 animate-ping"></span>
                    RECORDING...
                </div>
                <div id="timer" class="font-mono text-lg">00:00</div>
            </div>

            <label class="text-[10px] font-bold text-gray-400 uppercase">Mushaf (Target)</label>
            <div id="targetText" class="mushaf-box font-serif">
                بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ
            </div>

            <label class="text-[10px] font-bold text-gray-400 uppercase">Hasil Bacaan Kamu</label>
            <div id="userResult" class="correction-box mt-1 italic text-gray-500 min-h-[50px]">
                Silahkan mulai membaca...
            </div>

            <div id="feedbackText" class="mt-3 text-sm font-medium hidden">
                <!-- Feedback akan muncul di sini -->
            </div>
        </div>

        <!-- Panel Speaker (Menu Sebelumnya) -->
        <div id="speakerPanel" class="panel">
            <h3 class="font-bold text-gray-800 mb-4">Pengaturan Murottal</h3>
            <div class="space-y-3">
                <select class="w-full p-2 border rounded-lg text-sm">
                    <option>Pilih Qari (Drop Down)</option>
                </select>
                <div class="grid grid-cols-2 gap-2">
                    <select class="p-2 border rounded-lg text-xs"><option>Surat Al-Fatihah</option></select>
                    <input type="number" placeholder="Ayat" class="p-2 border rounded-lg text-xs">
                </div>
                <button class="w-full bg-[#00c853] text-white py-2 rounded-lg font-bold mt-2">Putar</button>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        const micBtn = document.getElementById('micBtn');
        const speakerBtn = document.getElementById('speakerBtn');
        const correctionPanel = document.getElementById('correctionPanel');
        const speakerPanel = document.getElementById('speakerPanel');
        const timerDisplay = document.getElementById('timer');
        const userResult = document.getElementById('userResult');
        const feedbackText = document.getElementById('feedbackText');

        let isRecording = false;
        let timerInt;
        let seconds = 0;

        // Simulasi Speech Recognition (Karena Browser butuh HTTPS dan Model Bahasa Arab)
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'ar-SA'; // Bahasa Arab
            recognition.interimResults = true;
            recognition.continuous = true;

            recognition.onresult = (event) => {
                const transcript = Array.from(event.results)
                    .map(result => result[0].transcript)
                    .join('');
                
                userResult.innerHTML = transcript;
                compareTexts(transcript);
            };
        }

        function compareTexts(transcript) {
            // Contoh sederhana membandingkan teks (Tanpa harakat)
            const target = "بسم الله الرحمن الرحيم";
            const cleanUser = transcript.replace(/[^\u0621-\u064A\s]/g, ""); // Hapus harakat untuk perbandingan
            
            feedbackText.classList.remove('hidden');
            if (target.includes(cleanUser) || cleanUser.includes(target)) {
                feedbackText.innerHTML = "✅ Bacaan Benar!";
                feedbackText.className = "mt-3 text-sm font-medium text-green-600";
            } else {
                feedbackText.innerHTML = "❌ Ada kesalahan, coba perhatikan makhrajnya.";
                feedbackText.className = "mt-3 text-sm font-medium text-red-600";
            }
        }

        micBtn.addEventListener('click', () => {
            isRecording = !isRecording;
            speakerPanel.classList.remove('active');
            
            if (isRecording) {
                micBtn.classList.add('recording');
                correctionPanel.classList.add('active');
                startTimer();
                if (recognition) recognition.start();
                userResult.innerHTML = "Mendengarkan...";
            } else {
                stopRecording();
            }
        });

        speakerBtn.addEventListener('click', () => {
            stopRecording();
            speakerPanel.classList.toggle('active');
            correctionPanel.classList.remove('active');
        });

        function startTimer() {
            seconds = 0;
            timerInt = setInterval(() => {
                seconds++;
                const m = Math.floor(seconds/60).toString().padStart(2, '0');
                const s = (seconds%60).toString().padStart(2, '0');
                timerDisplay.textContent = `${m}:${s}`;
            }, 1000);
        }

        function stopRecording() {
            isRecording = false;
            micBtn.classList.remove('recording');
            clearInterval(timerInt);
            if (recognition) recognition.stop();
        }
    </script>
</body>
</html>